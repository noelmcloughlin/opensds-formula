{%- macro getopts(outdict, sls=False) -%}
  {%- if outdict and 'options' in outdict %}
     {%- for k, v in outdict.options.items() %}
       {%- if sls %}
    - {{ k }}: {{ v }}
       {%- else %}
         {{- ' --' ~ k if v == True else '' if v == False else ' --' ~ k ~ ' ' ~ v  -}}
       {%- endif %}
      {%- endfor %}
   {%- endif %}
{%- endmacro %}

{%- macro getlist(outlist, sls=False) -%}
  {%- if outlist and outlist is iterable and outdict is not string %}
     {%- for v in outlist %}
       {%- if sls %}
    - {{ v }}
       {%- else %}
         {{- v -}}
       {%- endif %}
      {%- endfor %}
   {%- endif %}
{%- endmacro %}

{%- macro deep_merge(a, b) %}
  {%- for k,v in b.items() %}
    {%-if v is string or v is number %}
       {%- do a.update({ k: v }) %}
    {%-elif v is not mapping %}
       {%- if a[k] is not defined %}
         {%- do a.update({ k: v }) %}
       {%- elif a[k] is iterable and a[k] is not mapping and a[k] is not string %}
         {%- do a.update({ k: v|list + a[k]|list}) %}
       {%- else %}
         {%- do a.update({ k: v }) %}
       {%- endif %}
    {%- elif v is mapping %}
       {%- if a[k] is not defined %}
         {%- do a.update({ k: v }) %}
       {%- elif a[k] is not mapping %}
         {%- do a.update({ k: v }) %}
       {%- else %}
         {%- do deep_merge(a[k], v) %}
       {%- endif %}
    {%-else %}
      {%- do a.update({ k: 'ERROR: case not contempled in merging!' }) %}
    {%-endif %}
  {%- endfor %}
{%- endmacro %}
